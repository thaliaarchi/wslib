# Copyright (c) 2021 Andrew Archibald
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at https://mozilla.org/MPL/2.0/.

    "math" import
    "io"   import

    # Exp tests borrowed from Go
    # https://golang.org/src/math/big/int_test.go#L527

    0    0          call test_exp
    1    0          call test_exp
    -10  0          call test_exp
    1234 -1         call test_exp
    1234 -1    0    call test_modexp
    17   -100  1234 call test_modexp
    2    -100  1234 call test_modexp
    0    0     1    call test_modexp
    1    0     1    call test_modexp
    -10  0     1    call test_modexp
    1234 -1    1    call test_modexp
    5    1     3    call test_modexp
    5    -7         call test_exp
    -5   -7         call test_exp
    5    0          call test_exp
    -5   0          call test_exp
    5    1          call test_exp
    -5   1          call test_exp
    -5   1     7    call test_modexp
    -2   3     2    call test_modexp
    5    2          call test_exp
    1    65537 2    call test_modexp

    9223372036854775808 2             call test_exp
    9223372036854775808 2        6719 call test_modexp
    9223372036854775808 3        6719 call test_modexp
    9223372036854775808 1000     6719 call test_modexp
    9223372036854775808 1000000  6719 call test_modexp
    9223372036854775808 -1000000 6719 call test_modexp

    340282366920938463463374607431768211455
    1662864082237195566310326201168373022015780906889
    1418189353909770683508028082434312329
    call test_modexp

    2938462938472983472983659726349017249287491026512746239764525612965293865296239471239874193284792387498274256129746192347
    298472983472983471903246121093472394872319615612417471234712061
    29834729834729834729347290846729561262544958723956495615629569234729836259263598127342374289365912465901365498236492183464
    call test_modexp

    11001289118363089646017359372117963499250546375269047542777928006103246876688756735760905680604646624353196869572752623285140408755420374049317646428185270079555372763503115646054602867593662923894140940837479507194934267532831694565516466765025434902348314525627418515646588160955862839022051353653052947073136084780742729727874803457643848197499548297570026926927502505634297079527299004267769780768565695459945235586892627059178884998772989397505061206395455591503771677500931269477503508150175717121828518985901959919560700853226255420793148986854391552859459511723547532575574664944815966793196961286234040892865
    9247324572804102889565555777311914057954687482673431192869682151395651003606366864848904841770165182604035932529621174486515688424932060959148379649412557
    21766174458617435773191008891802753781907668374255538511144643224689886235383840957210909013086056401571399717235807266581649606472148410291413364152197364477180887395655483738115072677402235101762521901569820740293149529620419333266262073471054548368736039519702486226506248861060256971802984953561121442680157668000761429988222457090413873973970171927093992114751765168063614761119615476233422096442783117971236371647333871414335895773474667308967050807005509320424799678417036867928316761272274230314067548291133582479583061439577559347101961771406173684378522703483495337037655006751328447510550299250924469288819
    call test_modexp

    -406433107806066117724671127918333319356292137541743435963950056078916830599029304840314096986266415209224657355837736572200922261163426578651179331131393453988793860237218377235310492383052991190710496340935141634222043093630918151355287758455407438574603857807197323193543796704282457632629182117985956027344756573721567514880098048276151534703676759064670659469188726096428997021371814351238905656170764301138971404583017383454598548551490083189000750931917501000103588820172353162181746970031885719255647656318788280042451109911548051099338702770999665507389439368204693523628612571814083081853523955169312343114509112104365057376126477933949472021889879434438295890522570919854239271657682
    9247324572804102889565555777311914057954687482673431192869682151395651003606366864848904841770165182604035932529621174486515688424932060959148379649412557
    21766174458617435773191008891802753781907668374255538511144643224689886235383840957210909013086056401571399717235807266581649606472148410291413364152197364477180887395655483738115072677402235101762521901569820740293149529620419333266262073471054548368736039519702486226506248861060256971802984953561121442680157668000761429988222457090413873973970171927093992114751765168063614761119615476233422096442783117971236371647333871414335895773474667308967050807005509320424799678417036867928316761272274230314067548291133582479583061439577559347101961771406173684378522703483495337037655006751328447510550299250924469288819
    call test_modexp

    18446744069414584321
    18446744069414584321
    18446744069414584321
    call test_modexp

    79228162514264337589248983041
    79228162514264337589248983041
    79228162514264337589248983041
    call test_modexp

    340282366920938463463374607427473244161
    340282366920938463463374607427473244161
    340282366920938463463374607427473244161
    call test_modexp

    1461501637330902918203684832716283019651637575681
    1461501637330902918203684832716283019651637575681
    1461501637330902918203684832716283019651637575681
    call test_modexp

    2
    9247324572804102889565555777311914057954687482673431192869682151395651003606366864848904841770165182604035932529621174486515688424932060959148379649412557
    21766174458617435773191008891802753781907668374255538511144643224689886235383840957210909013086056401571399717235807266581649606472148410291413364152197364477180887395655483738115072677402235101762521901569820740293149529620419333266262073471054548368736039519702486226506248861060256971802984953561121442680157668000761429988222457090413873973970171927093992114751765168063614761119615476233422096442783117971236371647333871414335895773474667308967050807005509320424799678417036867928316761272274230314067548291133582479583061439577559347101961771406173684378522703483495337037655006751328447510550299250924469288819
    call test_modexp

    2
    9247324572804102889565555777311914057954687482673431192869682151395651003606366864848904841770165182604035932529621174486515688424932060959148379649412557
    21766174458617435773191008891802753781907668374255538511144643224689886235383840957210909013086056401571399717235807266581649606472148410291413364152197364477180887395655483738115072677402235101762521901569820740293149529620419333266262073471054548368736039519702486226506248861060256971802984953561121442680157668000761429988222457090413873973970171927093992114751765168063614761119615476233422096442783117971236371647333871414335895773474667308967050807005509320424799678417036867928316761272274230314067548291133582479583061439577559347101961771406173684378522703483495337037655006751328447510550299250924469288818
    call test_modexp

    1 -1 call test_tetrate
    1  0 call test_tetrate
    1  1 call test_tetrate
    1  2 call test_tetrate
    2 -1 call test_tetrate
    2  0 call test_tetrate
    2  1 call test_tetrate
    2  2 call test_tetrate
    2  3 call test_tetrate
    2  4 call test_tetrate
    3  1 call test_tetrate
    3  2 call test_tetrate
    3  3 call test_tetrate
    4  1 call test_tetrate
    4  2 call test_tetrate
    5  2 call test_tetrate
    6  2 call test_tetrate
    7  2 call test_tetrate
    8  2 call test_tetrate
    9  2 call test_tetrate
    10 2 call test_tetrate

    1 -1 call test_pentate
    1  0 call test_pentate
    1  1 call test_pentate
    1  2 call test_pentate
    2 -1 call test_pentate
    2  0 call test_pentate
    2  1 call test_pentate
    2  2 call test_pentate
    2  3 call test_pentate
    3  1 call test_pentate
    3  2 call test_pentate
    4  1 call test_pentate

    end

# (x y -- )
test_exp:
    -1 '\n'
    ^3 ^3 call math.exp -2
    " = "
    ^7 -2
    " ** "
    ^14 -2
    call io.printf
    2drop ret

# (x y m -- )
test_modexp:
    -1
    ")\n"
    ^3 -2
    " (mod "
    ^13 ^13 ^13 call math.modexp -2
    " = "
    ^17 -2
    " ** "
    ^24 -2
    call io.printf
    3drop ret

# (x y -- )
test_tetrate:
    -1
    '\n'
    ^3 ^3 call math.tetrate -2
    " = "
    ^7 -2
    " ^^ "
    ^14 -2
    call io.printf
    2drop ret

# (x y -- )
test_pentate:
    -1
    '\n'
    ^3 ^3 call math.pentate -2
    " = "
    ^7 -2
    " ^^^ "
    ^15 -2
    call io.printf
    2drop ret
